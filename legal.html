<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Legal Authority - Global Legal Excellence</title>
    <script src="https://www.paypal.com/sdk/js?client-id=AeA0BxVnKkzfCJ8zH_MmkCk-T5V5eYZ5zCc8CvzqCg7-6F0zF8tKmGnG_VdgOgJDaX5Q&currency=USD&components=buttons,hosted-fields"></script>
    <style>
        :root {
            --primary-gold: #D4AF37;
            --primary-dark: #1a1a2e;
            --primary-navy: #16213e;
            --accent-blue: #0f3460;
            --text-light: #f8f9fa;
            --text-dark: #2c3e50;
            --gradient-gold: linear-gradient(135deg, #D4AF37 0%, #FFD700 50%, #B8860B 100%);
            --gradient-dark: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --shadow-premium: 0 20px 60px rgba(212, 175, 55, 0.15);
            --shadow-dark: 0 15px 35px rgba(0, 0, 0, 0.3);
            --success-green: #28a745;
            --warning-orange: #fd7e14;
            --danger-red: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.7;
            color: var(--text-dark);
            background: var(--text-light);
            overflow-x: hidden;
        }

        /* Premium scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--primary-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-gold);
            border-radius: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Modal System */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            backdrop-filter: blur(10px);
              z-index: 9999; /* makes sure it overlays everything */

        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-premium);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: #666;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--primary-gold);
        }

        /* Premium Header */
        header {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            color: var(--text-light);
            padding: 1.2rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 2000;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        header.scrolled {
            background: rgba(26, 26, 46, 0.98);
            box-shadow: var(--shadow-dark);
            backdrop-filter: blur(30px);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-gold);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .logo i {
            font-size: 2.2rem;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo:hover {
            transform: scale(1.02);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 3rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 500;
            position: relative;
            transition: all 0.3s ease;
            padding: 0.5rem 0;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--gradient-gold);
            transition: width 0.4s ease;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .nav-links a:hover {
            color: var(--primary-gold);
        }

        .consultation-btn, .client-portal-btn {
            background: var(--gradient-gold);
            color: var(--primary-dark);
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-premium);
            margin-left: 1rem;
            cursor: pointer;
            border: none;
        }

        .consultation-btn:hover, .client-portal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 80px rgba(212, 175, 55, 0.3);
        }

        /* Hero Section */
        .hero {
            background: var(--gradient-dark);
            color: var(--text-light);
            padding: 150px 0 100px;
            position: relative;
            overflow: hidden;
            min-height: 100vh;
            display: flex;
            align-items: center;
        }

        .hero-content {
            position: relative;
            z-index: 10;
            max-width: 800px;
        }

        .hero h1 {
            font-size: clamp(3rem, 6vw, 5.5rem);
            font-weight: 300;
            margin-bottom: 2rem;
            line-height: 1.1;
            opacity: 0;
            animation: slideInUp 1.2s ease-out 0.3s forwards;
        }

        .hero h1 .highlight {
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 3rem;
            opacity: 0.9;
            line-height: 1.6;
            opacity: 0;
            animation: slideInUp 1.2s ease-out 0.6s forwards;
        }

        .hero-cta {
            display: flex;
            gap: 2rem;
            align-items: center;
            opacity: 0;
            animation: slideInUp 1.2s ease-out 0.9s forwards;
            flex-wrap: wrap;
        }

        .primary-btn {
            background: var(--gradient-gold);
            color: var(--primary-dark);
            padding: 18px 36px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-premium);
            position: relative;
            overflow: hidden;
            border: none;
            cursor: pointer;
        }

        .primary-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .primary-btn:hover::before {
            left: 100%;
        }

        .primary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 30px 80px rgba(212, 175, 55, 0.4);
        }

        .secondary-btn {
            color: gold;
            text-decoration: none;
            background: gold;
            font-weight: 500;
            padding: 18px 24px;
            border: 2px solid var(--primary-gold);
            border-radius: 50px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            cursor: pointer;
        }

        .secondary-btn:hover {
            background: var(--primary-gold);
            color: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Service Plans */
        .service-plans {
            padding: 120px 0;
            background: var(--text-light);
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 3rem;
            margin-top: 4rem;
        }

        .plan-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            position: relative;
            transition: all 0.4s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            border: 2px solid transparent;
        }

        .plan-card.featured {
            border-color: var(--primary-gold);
            transform: scale(1.05);
        }

        .plan-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-premium);
        }

        .plan-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-gold);
            color: var(--primary-dark);
            padding: 8px 24px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .plan-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }

        .plan-price {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-gold);
            margin-bottom: 0.5rem;
        }

        .plan-period {
            color: #666;
            margin-bottom: 2rem;
        }

        .plan-features {
            list-style: none;
            margin-bottom: 3rem;
        }

        .plan-features li {
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .plan-features li i {
            color: var(--success-green);
            font-size: 1.1rem;
        }

        .plan-btn {
            width: 100%;
            padding: 15px;
            background: var(--gradient-gold);
            color: var(--primary-dark);
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .plan-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-premium);
        }

        /* Expertise Areas */
        .expertise {
            padding: 120px 0;
            background: var(--text-light);
            position: relative;
        }

        .section-header {
            text-align: center;
            margin-bottom: 5rem;
        }

        .section-title {
            font-size: 3.5rem;
            font-weight: 300;
            color: var(--primary-dark);
            margin-bottom: 1.5rem;
            position: relative;
        }

        .section-title .highlight {
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.7;
        }

        .expertise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 3rem;
            margin-top: 4rem;
        }

        .expertise-card {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-top: 4px solid var(--primary-gold);
        }

        .expertise-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-premium);
        }

        .expertise-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            color: var(--primary-dark);
            font-size: 2rem;
        }

        .expertise-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary-dark);
            font-weight: 600;
        }

        .expertise-card p {
            color: #666;
            line-height: 1.7;
            margin-bottom: 2rem;
        }

 .expertise-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 5px 10px;
    background: var(--gradient-gold); /* Premium gold background */
    color: var(--primary-dark);       /* Dark text for contrast */
    font-weight: 600;
    text-transform: uppercase;
    border-radius: 30px;
    border: none;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--shadow-premium);
    position: relative;
    overflow: hidden;
}

/* Arrow inside the button */
.expertise-link i {
    display: inline-block;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    font-size:40px;
    margin-bottom:7px;
}

/* Hover Effect */
.expertise-link:hover {
    transform: translateY(-3px);
    box-shadow: 0 25px 80px rgba(212, 175, 55, 0.4);
    gap: 1rem; /* Text and arrow spacing increases */
}

.expertise-link:hover i {
    transform: translateX(6px); /* Arrow slides forward */
}

        /* Payment Form Styles */
        .payment-form {
            margin-top: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .paypal-button-container {
            margin-top: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        /* Statistics Section */
        .stats {
            background: var(--gradient-dark);
            color: var(--text-light);
            padding: 100px 0;
            position: relative;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
        }

        .stat-item {
            text-align: center;
            padding: 2rem;
        }

        .stat-number {
            font-size: 4rem;
            font-weight: 700;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: block;
            margin-bottom: 1rem;
        }

        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

    .consultation-btn,
.client-portal-btn {
    background: var(--gradient-gold);
    color: var(--primary-dark);
    padding: 12px 28px;
    border-radius: 50px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-premium);
    margin: 0;               /* spacing handled by container gap */
    cursor: pointer;
    border: none;

    /* ensure consistent sizing/placement like nav buttons */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
    min-width: 160px;
    white-space: nowrap;
}
      
      
      .consultation-btn:hover,
.client-portal-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 25px 80px rgba(212, 175, 55, 0.3);
}



@media (min-width: 1024px) {
    .client-dashboard {
        padding: 140px 6%;
        justify-content: space-between; /* spread across the section like a nav bar */
    }

    /* When using space-between we avoid extra automatic gaps on buttons */
    .consultation-btn,
    .client-portal-btn {
        margin: 5px;
    }
}

        .dashboard-nav {
            display: flex;
            gap: 2rem;
            margin-bottom: 3rem;
            border-bottom: 2px solid #eee;
        }

        .dashboard-nav button {
            background: none;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .dashboard-nav button.active {
            color: var(--primary-gold);
            border-bottom-color: var(--primary-gold);
        }

        .dashboard-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }

        .case-card {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary-gold);
        }

        .case-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        .case-status.active {
            background: var(--success-green);
            color: white;
        }

        .case-status.pending {
            background: var(--warning-orange);
            color: white;
        }

        .case-status.completed {
            background: var(--primary-gold);
            color: var(--primary-dark);
        }

/* Advanced AI Chat Widget Styles */
.chat-widget {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 5000;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.chat-toggle {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: var(--gradient-gold);
    border: none;
    color: var(--primary-dark);
    font-size: 1.8rem;
    cursor: pointer;
    box-shadow: 0 8px 32px rgba(212, 175, 55, 0.3);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.chat-toggle::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: conic-gradient(from 0deg, var(--primary-gold), #FFD700, var(--primary-gold));
    border-radius: 50%;
    z-index: -1;
    animation: rotate 3s linear infinite;
}

.chat-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 40px rgba(212, 175, 55, 0.4);
}

.chat-pulse {
    position: absolute;
    top: -4px;
    right: -4px;
    width: 18px;
    height: 18px;
    background: #00ff88;
    border-radius: 50%;
    border: 3px solid white;
    animation: pulse 2s infinite;
}

.chat-icon {
    animation: bounce 2s infinite;
}

.chat-window {
    position: absolute;
    bottom: 90px;
    right: 0;
    width: 420px;
    height: 580px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 80px rgba(0, 0, 0, 0.15);
    display: none;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid rgba(212, 175, 55, 0.1);
}

.chat-window.active {
    display: flex;
    animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.chat-header {
    background: var(--gradient-gold);
    color: var(--primary-dark);
    padding: 1.2rem;
    border-radius: 20px 20px 0 0;
}

.chat-header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.chat-avatar {
    width: 45px;
    height: 45px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    color: var(--primary-dark);
}

.chat-header-text {
    flex: 1;
    margin-left: 1rem;
}

.chat-title {
    display: block;
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 0.2rem;
}

.chat-status {
    display: block;
    font-size: 0.85rem;
    opacity: 0.8;
    display: flex;
    align-items: center;
}

.chat-status::before {
    content: '';
    width: 8px;
    height: 8px;
    background: #00ff88;
    border-radius: 50%;
    margin-right: 0.5rem;
    animation: pulse 2s infinite;
}

.chat-minimize {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    color: var(--primary-dark);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
}

.chat-minimize:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.chat-messages {
    flex: 1;
    padding: 1.5rem 1.2rem;
    overflow-y: auto;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.chat-messages::-webkit-scrollbar {
    width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.chat-messages::-webkit-scrollbar-thumb {
    background: var(--primary-gold);
    border-radius: 10px;
}

.message {
    display: flex;
    align-items: flex-start;
    gap: 0.8rem;
    max-width: 85%;
    animation: messageSlideIn 0.3s ease-out;
}

.message.user {
    flex-direction: row-reverse;
    margin-left: auto;
}

.message-avatar {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    flex-shrink: 0;
}

.message.bot .message-avatar {
    background: var(--gradient-gold);
    color: var(--primary-dark);
}

.message.user .message-avatar {
    background: var(--primary-navy);
    color: white;
}

.message-content {
    flex: 1;
}

.message-text {
    background: white;
    padding: 1rem 1.2rem;
    border-radius: 18px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    line-height: 1.5;
    font-size: 0.95rem;
    word-wrap: break-word;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.message.user .message-text {
    background: var(--gradient-gold);
    color: var(--primary-dark);
    font-weight: 500;
}

.message.bot .message-text {
    color: var(--text-dark);
    position: relative;
}

.message.bot .message-text::before {
    content: '';
    position: absolute;
    left: -8px;
    top: 12px;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-right: 8px solid white;
}

.message.user .message-text::before {
    content: '';
    position: absolute;
    right: -8px;
    top: 12px;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-left: 8px solid var(--primary-gold);
}

.message-time {
    font-size: 0.75rem;
    color: #999;
    margin-top: 0.4rem;
    text-align: right;
}

.message.user .message-time {
    text-align: left;
}

.welcome-message .message-text {
    background: linear-gradient(135deg, var(--primary-gold) 0%, #FFD700 100%);
    color: var(--primary-dark);
    font-weight: 600;
    border: none;
}

/* Quick Action Buttons in Chat */
.chat-quick-actions {
    max-width: 100% !important;
    margin: 0 !important;
}

.chat-quick-actions .primary-btn,
.chat-quick-actions .secondary-btn {
    padding: 0.8rem 1.2rem;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    text-transform: none;
    letter-spacing: 0.5px;
}

.chat-quick-actions .primary-btn {
    background: var(--gradient-gold);
    color: var(--primary-dark);
    box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
}

.chat-quick-actions .primary-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
}

.chat-quick-actions .secondary-btn {
    background: white;
    color: var(--primary-dark);
    border: 2px solid var(--primary-gold);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chat-quick-actions .secondary-btn:hover {
    background: var(--primary-gold);
    color: var(--primary-dark);
    transform: translateY(-2px);
}

/* Theme buttons in chat */
.chat-quick-actions .theme-btn {
    padding: 0.6rem 1rem;
    border-radius: 10px;
    border: 2px solid #ddd;
    background: white;
    color: var(--text-dark);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
}

.chat-quick-actions .theme-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Typing Indicator */
.typing-indicator {
    display: none;
    padding: 0.8rem 1.2rem;
    background: white;
    border-radius: 18px;
    margin: 0 1.2rem 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    align-items: center;
    gap: 0.8rem;
}

.typing-indicator.show {
    display: flex;
    animation: fadeIn 0.3s ease;
}

.typing-dots {
    display: flex;
    gap: 4px;
}

.typing-dots span {
    width: 8px;
    height: 8px;
    background: var(--primary-gold);
    border-radius: 50%;
    animation: typingPulse 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-dots span:nth-child(3) {
    animation-delay: 0.4s;
}

.typing-text {
    font-size: 0.85rem;
    color: #666;
    font-style: italic;
}

/* Chat Input */
.chat-input-container {
    padding: 1.2rem;
    border-top: 1px solid #eee;
    background: white;
    border-radius: 0 0 20px 20px;
}

.chat-input-wrapper {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    background: #f8f9fa;
    border-radius: 25px;
    padding: 0.3rem;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.chat-input-wrapper:focus-within {
    border-color: var(--primary-gold);
    box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    background: white;
}

.chat-input {
    flex: 1;
    border: none;
    background: transparent;
    padding: 0.8rem 1rem;
    font-size: 0.95rem;
    outline: none;
    color: var(--text-dark);
}

.chat-input::placeholder {
    color: #999;
}

.chat-send-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--gradient-gold);
    border: none;
    color: var(--primary-dark);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
}

.chat-send-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
}

.chat-send-btn:active {
    transform: scale(0.95);
}

/* Form Styles in Chat */
.chat-messages form {
    background: white;
    padding: 1.2rem;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(212, 175, 55, 0.2);
    margin: 0.5rem 0;
}

.chat-messages form input,
.chat-messages form select,
.chat-messages form textarea {
    width: 100%;
    padding: 0.8rem;
    border: 2px solid #eee;
    border-radius: 10px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    margin-bottom: 0.8rem;
}

.chat-messages form input:focus,
.chat-messages form select:focus,
.chat-messages form textarea:focus {
    outline: none;
    border-color: var(--primary-gold);
    box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
}

/* Responsive Design */
@media (max-width: 768px) {
    .chat-window {
        width: 350px;
        height: 500px;
        bottom: 80px;
        right: 1rem;
    }
    
    .chat-widget {
        bottom: 1rem;
        right: 1rem;
    }
    
    .chat-toggle {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
    }
}

@media (max-width: 480px) {
    .chat-window {
        width: calc(100vw - 2rem);
        height: 450px;
        right: 1rem;
        left: 1rem;
    }
    
    .message {
        max-width: 95%;
    }
}

/* Animations */
@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.05); }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-3px); }
    60% { transform: translateY(-2px); }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes messageSlideIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes typingPulse {
    0%, 60%, 100% {
        transform: scale(1);
        opacity: 1;
    }
    30% {
        transform: scale(1.4);
        opacity: 0.7;
    }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
        }

        .alert.success {
            background: rgba(40, 167, 69, 0.1);
            border-left-color: var(--success-green);
            color: var(--success-green);
        }

        .alert.error {
            background: rgba(220, 53, 69, 0.1);
            border-left-color: var(--danger-red);
            color: var(--danger-red);
        }

        .alert.warning {
            background: rgba(253, 126, 20, 0.1);
            border-left-color: var(--warning-orange);
            color: var(--warning-orange);
        }
        
        :root{--primary-gold:#D4AF37;--primary-dark:#1a1a2e;--text-light:#f8f9fa;--text-dark:#2c3e50}
body{font-family:Georgia,Times New Roman,serif;margin:0;background:var(--text-light);color:var(--text-dark)}
.primary-btn{background:var(--primary-gold);color:var(--primary-dark);padding:12px 20px;border-radius:50px;border:none;cursor:pointer}
.secondary-btn{background:none;border:2px solid var(--primary-gold);padding:10px 18px;border-radius:50px;cursor:pointer}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:10000;align-items:center;justify-content:center}
.modal.active{display:flex}
.modal-content{background:#fff;padding:24px;border-radius:12px;max-width:720px;width:92%}
.alert{padding:12px 16px;border-radius:8px;margin-bottom:12px}
.alert.success{background:rgba(40,167,69,.08);border-left:4px solid #28a745;color:#166a39}
.alert.error{background:rgba(220,53,69,.08);border-left:4px solid #dc3545;color:#8b1f2a}
  #tourModal { position:fixed; inset:0; display:none; z-index:15000; align-items:center; justify-content:center; font-family:Arial, sans-serif; }
  #tourModal.show { display:flex; }
  #tourModal .backdrop { position:absolute; inset:0; background:rgba(0,0,0,0.55); }
  #tourModal .panel {
    position:relative; z-index:15010; width:min(760px, 94vw); max-height:84vh; overflow:auto;
    background:#fff; border-radius:12px; padding:18px; box-shadow:0 20px 60px rgba(0,0,0,.25);
  }
  #tourModal .header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px; }
  #tourModal h3 { margin:0; font-size:18px; color:#111; }
  #tourModal .meta { color:#555; font-size:13px; margin-bottom:10px; }
  #tourModal .colors { display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
  .tour-swatch { display:inline-flex; gap:8px; align-items:center; padding:6px 8px; border-radius:8px; border:1px solid #f0f0f0; font-size:13px; }
  .tour-swatch .box { width:28px; height:18px; border-radius:4px; border:1px solid rgba(0,0,0,.06); display:inline-block; }
  #tourModal .body { font-size:14px; color:#222; margin-bottom:12px; line-height:1.45; }
  #tourModal .footer { display:flex; gap:8px; justify-content:flex-end; margin-top:6px; }
  .tour-action { padding:8px 12px; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer; font-weight:700; }
  .tour-action.primary { background: linear-gradient(90deg,#D4AF37,#FFD700); color:#111; border:none; }
  .tour-action.ghost { background:transparent; }
  .tour-note { font-size:12px; color:#666; margin-right:auto; align-self:center; }
  @media (max-width:520px){ #tourModal .panel{ padding:14px; } }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <a href="#home" class="logo">
                <i class="fas fa-balance-scale"></i>
                <span>Elite Legal Authority</span>
            </a>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#expertise">Practice Areas</a></li>
                <li><a href="#global">Global Presence</a></li>
                <li><a href="#contact">Contact Us</a></li>
                <li>
                    <button class="consultation-btn" onclick="openModal('consultationModal')">Free Consultation</button>
                    <button class="client-portal-btn" onclick="openModal('clientPortalModal')">Client Portal</button>
                </li>
              
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero" id="home">
            <div class="container">
                <div class="hero-content">
                    <h1>Elite <span class="highlight">Legal Authority</span> for Global Leaders</h1>
                    <p>Providing unparalleled legal expertise across international markets. Our world-class team delivers strategic counsel that shapes industries and protects your most critical interests.</p>
                    <div class="hero-cta">
                        <button class="primary-btn" onclick="openModal('consultationModal')">Schedule Consultation</button>
                        <button class="secondary-btn" onclick="scrollToSection('services')">
                            <span>Explore Our Services</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                        <button class="secondary-btn" onclick="openModal('emergencyModal')">
                            <span>24/7 Emergency Legal</span>
                            <i class="fas fa-phone"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="service-plans" id="services">
            <div class="container">
                <div class="section-header reveal">
                    <h2 class="section-title">Legal <span class="highlight">Service Plans</span></h2>
                    <p class="section-subtitle">Choose the perfect legal service plan for your needs. From startups to Fortune 500 companies, we have tailored solutions for every client.</p>
                </div>
                <div class="plans-grid">
                    <div class="plan-card reveal">
                        <h3 class="plan-title">Consultation</h3>
                        <div class="plan-price">$500</div>
                        <div class="plan-period">per consultation</div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> 1-hour legal consultation</li>
                            <li><i class="fas fa-check"></i> Expert legal advice</li>
                            <li><i class="fas fa-check"></i> Written summary report</li>
                            <li><i class="fas fa-check"></i> Follow-up email support</li>
                            <li><i class="fas fa-check"></i> 48-hour response time</li>
                        </ul>
                        <button class="plan-btn" onclick="openPaymentModal('consultation', 500)">Get Started</button>
                    </div>
                    <div class="plan-card featured reveal">
                        <div class="plan-badge">Most Popular</div>
                        <h3 class="plan-title">Business Legal</h3>
                        <div class="plan-price">$2,500</div>
                        <div class="plan-period">per month</div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Unlimited consultations</li>
                            <li><i class="fas fa-check"></i> Contract review & drafting</li>
                            <li><i class="fas fa-check"></i> Compliance monitoring</li>
                            <li><i class="fas fa-check"></i> Priority client support</li>
                            <li><i class="fas fa-check"></i> Quarterly legal audits</li>
                            <li><i class="fas fa-check"></i> 24/7 emergency hotline</li>
                        </ul>
                        <button class="plan-btn" onclick="openPaymentModal('business', 2500)">Get Started</button>
                    </div>
                    <div class="plan-card reveal">
                        <h3 class="plan-title">Enterprise</h3>
                        <div class="plan-price">$10,000</div>
                        <div class="plan-period">per month</div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Dedicated legal team</li>
                            <li><i class="fas fa-check"></i> Full legal department services</li>
                            <li><i class="fas fa-check"></i> M&A and transaction support</li>
                            <li><i class="fas fa-check"></i> Global jurisdiction coverage</li>
                            <li><i class="fas fa-check"></i> Board meeting attendance</li>
                            <li><i class="fas fa-check"></i> Regulatory compliance suite</li>
                            <li><i class="fas fa-check"></i> White-glove service</li>
                        </ul>
                        <button class="plan-btn" onclick="openPaymentModal('enterprise', 10000)">Get Started</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="expertise" id="expertise">
            <div class="container">
                <div class="section-header reveal">
                    <h2 class="section-title">Premier <span class="highlight">Legal Expertise</span></h2>
                    <p class="section-subtitle">Delivering exceptional legal solutions across diverse practice areas with unmatched precision and strategic insight for Fortune 500 companies and global leaders.</p>
                </div>
                <div class="expertise-grid">
                    <div class="expertise-card reveal">
                        <div class="expertise-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <h3>Corporate Law & M&A</h3>
                        <p>Navigate complex mergers, acquisitions, and corporate restructuring with our elite team of corporate law specialists. We provide strategic guidance for billion-dollar transactions.</p>
                        <button class="expertise-link" onclick="openModal('corporateModal')">
                            <span>Learn More</span>
                            <i class="fas fa-arrow-right">→
</i>
                        </button>
                    </div>
                    <div class="expertise-card reveal">
                        <div class="expertise-icon">
                            <i class="fas fa-globe-americas"></i>
                        </div>
                        <h3>International Trade Law</h3>
                        <p>Expert counsel on cross-border transactions, trade regulations, and international compliance. Our global network ensures seamless legal support across all jurisdictions.</p>
                        <button class="expertise-link" onclick="openModal('tradeModal')">
                            <span>Learn More</span>
                            <i class="fas fa-arrow-right">→
</i>
                        </button>
                    </div>
                    <div class="expertise-card reveal">
                        <div class="expertise-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Securities & Finance</h3>
                        <p>Comprehensive securities law services including IPOs, private placements, and regulatory compliance. We've facilitated over $50B in capital market transactions.</p>
                        <button class="expertise-link" onclick="openModal('securitiesModal')">
                            <span>Learn More</span>
                            <i class="fas fa-arrow-right">→
</i>
                        </button>
                    </div>
                    <div class="expertise-card reveal">
                        <div class="expertise-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Intellectual Property</h3>
                        <p>Protect and maximize your intellectual assets with our award-winning IP team. From patents to trademarks, we safeguard innovation across global markets.</p>
                        <button class="expertise-link" onclick="openModal('ipModal')">
                            <span>Learn More</span>
                            <i class="fas fa-arrow-right">→
</i>
                        </button>
                    </div>
                    <div class="expertise-card reveal">
                        <div class="expertise-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <h3>Commercial Litigation</h3>
                        <p>World-class litigation team with an exceptional track record in high-stakes commercial disputes. We've secured over $10B in favorable judgments and settlements.</p>
                        <button class="expertise-link" onclick="openModal('litigationModal')">
                            <span>Learn More</span>
                            <i class="fas fa-arrow-right">→
</i>
                        </button>
                    </div>
                    <div class="expertise-card reveal">
                        <div class="expertise-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3>Executive Advisory</h3>
                        <p>Strategic legal counsel for C-suite executives and board members. Navigate governance, compliance, and risk management with confidence and precision.</p>
                        <button class="expertise-link" onclick="openModal('executiveModal')">
                            <span>Learn More </span>
                            <i class="fas fa-arrow-right">→
</i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="stats">
            <div class="container">
                <div class="stats-grid reveal">
                    <div class="stat-item">
                        <span class="stat-number" data-target="150">0</span>
                        <span class="stat-label">Countries Served</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" data-target="500">0</span>
                        <span class="stat-label">Fortune 500 Clients</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" data-target="99.8">0</span>
                        <span class="stat-label">Success Rate %</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" data-target="50">0</span>
                        <span class="stat-label">Billion $ Transacted</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="global-presence" id="global" style="padding: 120px 0; background: var(--text-light);">
            <div class="container">
                <div class="section-header reveal">
                    <h2 class="section-title">Global <span class="highlight">Presence</span></h2>
                    <p class="section-subtitle">Strategic offices in major financial centers worldwide, ensuring local expertise with global perspective for our international clientele.</p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-top: 4rem;">
                    <div style="background: white; padding: 2.5rem; border-radius: 15px; text-align: center; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; border: 1px solid rgba(212, 175, 55, 0.1);" class="reveal office-card">
                        <i class="fas fa-city" style="font-size: 3rem; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--primary-dark); margin-bottom: 1rem; font-size: 1.3rem;">New York</h3>
                        <p style="color: #666; font-size: 0.95rem;">Wall Street Financial District<br>Principal Office & Americas HQ</p>
                    </div>
                    <div style="background: white; padding: 2.5rem; border-radius: 15px; text-align: center; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; border: 1px solid rgba(212, 175, 55, 0.1);" class="reveal office-card">
                        <i class="fas fa-landmark" style="font-size: 3rem; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--primary-dark); margin-bottom: 1rem; font-size: 1.3rem;">London</h3>
                        <p style="color: #666; font-size: 0.95rem;">Canary Wharf Financial Centre<br>European Operations Hub</p>
                    </div>
                    <div style="background: white; padding: 2.5rem; border-radius: 15px; text-align: center; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; border: 1px solid rgba(212, 175, 55, 0.1);" class="reveal office-card">
                        <i class="fas fa-building" style="font-size: 3rem; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--primary-dark); margin-bottom: 1rem; font-size: 1.3rem;">Hong Kong</h3>
                        <p style="color: #666; font-size: 0.95rem;">Central Financial District<br>Asia-Pacific Headquarters</p>
                    </div>
                    <div style="background: white; padding: 2.5rem; border-radius: 15px; text-align: center; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; border: 1px solid rgba(212, 175, 55, 0.1);" class="reveal office-card">
                        <i class="fas fa-university" style="font-size: 3rem; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--primary-dark); margin-bottom: 1rem; font-size: 1.3rem;">Singapore</h3>
                        <p style="color: #666; font-size: 0.95rem;">Marina Bay Financial Centre<br>Southeast Asia Operations</p>
                    </div>
                    <div style="background: white; padding: 2.5rem; border-radius: 15px; text-align: center; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; border: 1px solid rgba(212, 175, 55, 0.1);" class="reveal office-card">
                        <i class="fas fa-globe-europe" style="font-size: 3rem; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--primary-dark); margin-bottom: 1rem; font-size: 1.3rem;">Frankfurt</h3>
                        <p style="color: #666; font-size: 0.95rem;">Banking Quarter<br>Continental Europe Hub</p>
                    </div>
                    <div style="background: white; padding: 2.5rem; border-radius: 15px; text-align: center; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; border: 1px solid rgba(212, 175, 55, 0.1);" class="reveal office-card">
                        <i class="fas fa-torii-gate" style="font-size: 3rem; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--primary-dark); margin-bottom: 1rem; font-size: 1.3rem;">Tokyo</h3>
                        <p style="color: #666; font-size: 0.95rem;">Marunouchi Business District<br>Japan & North Asia Office</p>
                    </div>
                </div>
            </div>
        </section>

        <section style="background: var(--primary-navy); color: var(--text-light); padding: 100px 0; text-align: center; position: relative;" id="contact">
            <div class="container">
                <h2 class="reveal" style="font-size: 3rem; font-weight: 300; margin-bottom: 2rem;">Ready to Engage <span class="highlight">Elite Legal Counsel</span>?</h2>
                <p class="reveal" style="font-size: 1.2rem; margin-bottom: 3rem; opacity: 0.9; max-width: 600px; margin-left: auto; margin-right: auto;">Join the world's most successful companies who trust Elite Legal Authority with their most critical legal matters. Schedule your confidential consultation today.</p>
                <div class="hero-cta reveal">
                    <button class="primary-btn" onclick="openModal('consultationModal')">Schedule Consultation</button>
                    <button class="secondary-btn" onclick="openModal('emergencyModal')">
                        <span>Call +1 (212) 555-0123</span>
                        <i class="fas fa-phone"></i>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div id="consultationModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('consultationModal')">&times;</button>
            <h2 style="text-align: center; margin-bottom: 2rem; color: var(--primary-dark);">Schedule Your Consultation</h2>
            <form id="consultationForm" class="payment-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name *</label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name *</label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="company">Company</label>
                        <input type="text" id="company" name="company">
                    </div>
                </div>
                <div class="form-group">
                    <label for="legalArea">Legal Area *</label>
                    <select id="legalArea" name="legalArea" required>
                        <option value="">Select Legal Area</option>
                        <option value="corporate">Corporate Law & M&A</option>
                        <option value="international">International Trade</option>
                        <option value="securities">Securities & Finance</option>
                        <option value="ip">Intellectual Property</option>
                        <option value="litigation">Commercial Litigation</option>
                        <option value="executive">Executive Advisory</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="urgency">Urgency Level *</label>
                    <select id="urgency" name="urgency" required>
                        <option value="">Select Urgency</option>
                        <option value="routine">Routine (1-2 weeks)</option>
                        <option value="urgent">Urgent (3-5 days)</option>
                        <option value="critical">Critical (24-48 hours)</option>
                        <option value="emergency">Emergency (Same day)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="description">Brief Description of Legal Matter *</label>
                    <textarea id="description" name="description" rows="4" required placeholder="Please provide a brief description of your legal needs..."></textarea>
                </div>
                <div class="form-group">
                    <label for="budget">Estimated Budget Range</label>
                    <select id="budget" name="budget">
                        <option value="">Select Budget Range</option>
                        <option value="under-10k">Under $10,000</option>
                        <option value="10k-50k">$10,000 - $50,000</option>
                        <option value="50k-100k">$50,000 - $100,000</option>
                        <option value="100k-500k">$100,000 - $500,000</option>
                        <option value="500k-1m">$500,000 - $1,000,000</option>
                        <option value="over-1m">Over $1,000,000</option>
                    </select>
                </div>
                <button type="submit" class="primary-btn" style="width: 100%; margin-top: 2rem;">
                    Schedule Free Consultation
                </button>
            </form>
        </div>
    </div>

    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('paymentModal')">&times;</button>
            <h2 style="text-align: center; margin-bottom: 2rem; color: var(--primary-dark);">Complete Your Purchase</h2>
            <div id="paymentDetails"></div>
            <form id="paymentForm" class="payment-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="payFirstName">First Name *</label>
                        <input type="text" id="payFirstName" name="payFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="payLastName">Last Name *</label>
                        <input type="text" id="payLastName" name="payLastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="payEmail">Email Address *</label>
                    <input type="email" id="payEmail" name="payEmail" required>
                </div>
                <div class="form-group">
                    <label for="payCompany">Company Name</label>
                    <input type="text" id="payCompany" name="payCompany">
                </div>
                <div class="form-group">
                    <label for="payPhone">Phone Number *</label>
                    <input type="tel" id="payPhone" name="payPhone" required>
                </div>
                <div class="form-group">
                    <label for="payAddress">Billing Address *</label>
                    <input type="text" id="payAddress" name="payAddress" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="payCity">City *</label>
                        <input type="text" id="payCity" name="payCity" required>
                    </div>
                    <div class="form-group">
                        <label for="payZip">ZIP Code *</label>
                        <input type="text" id="payZip" name="payZip" required>
                    </div>
                </div>
                <div class="paypal-button-container">
                    <p style="text-align: center; margin-bottom: 1rem; color: #666;">
                        <strong>Secure Payment via PayPal</strong><br>
                        You can pay with PayPal or any major credit card
                    </p>
                    <div id="paypal-button-container"></div>
                </div>
            </form>
        </div>
    </div>
<!-- ===== Client Portal (Login) - REPLACED ===== -->
<div id="clientPortalModal" class="modal">
  <div class="modal-content" style="padding:2.4rem; max-width:520px;">
    <button class="modal-close" onclick="closeModal('clientPortalModal')">&times;</button>
    <h2 style="text-align: center; margin-bottom: 1.2rem; color: var(--primary-dark);">Client Portal Login</h2>

    <form id="loginForm" class="payment-form">
      <div class="form-group">
        <label for="loginEmail">Email Address</label>
        <input type="email" id="loginEmail" name="loginEmail" required>
      </div>

      <div class="form-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" name="loginPassword" required>
      </div>

      <button type="submit" class="primary-btn" style="width: 100%; margin-bottom: 1rem;">
        Login to Portal
      </button>

      <div style="text-align: center;">
        <a href="#" style="color: var(--primary-gold); text-decoration: none;" onclick="showForgotPassword(event)">Forgot Password?</a>
        <span style="margin: 0 1rem;">|</span>
        <a href="#" style="color: var(--primary-gold); text-decoration: none;" onclick="showRegister(event)">Create Account</a>
      </div>
    </form>
  </div>
</div>

<!-- ===== Register / Create Account Modal (separate padding) ===== -->
<div id="registerModal" class="modal">
  <div class="modal-content register" style="padding:3.6rem; max-width:600px;">
    <button class="modal-close" onclick="closeModal('registerModal')">&times;</button>
    <h2 style="text-align:center; margin-bottom:1rem; color: var(--primary-dark);">Create Account</h2>

    <form id="registerForm" class="payment-form">
      <div class="form-row">
        <div class="form-group">
          <label for="regFirstName">First Name *</label>
          <input type="text" id="regFirstName" name="regFirstName" required>
        </div>
        <div class="form-group">
          <label for="regLastName">Last Name *</label>
          <input type="text" id="regLastName" name="regLastName" required>
        </div>
      </div>

      <div class="form-group">
        <label for="regEmail">Email *</label>
        <input type="email" id="regEmail" name="regEmail" required>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="regPassword">Password *</label>
          <input type="password" id="regPassword" name="regPassword" required minlength="6">
        </div>
        <div class="form-group">
          <label for="regConfirmPassword">Confirm Password *</label>
          <input type="password" id="regConfirmPassword" name="regConfirmPassword" required minlength="6">
        </div>
      </div>

      <div class="form-group">
        <label for="regCompany">Company (optional)</label>
        <input type="text" id="regCompany" name="regCompany">
      </div>

      <button type="submit" class="primary-btn" style="width:100%; margin-top:1rem;">
        Create Account
      </button>

      <div style="text-align:center; margin-top:1rem;">
        <a href="#" style="color:var(--primary-gold); text-decoration:none;" onclick="closeModal('registerModal'); openModal('clientPortalModal')">Back to Login</a>
      </div>
    </form>
  </div>
</div>

<!-- ===== Forgot Password Modal (separate padding) ===== -->
<div id="forgotModal" class="modal">
  <div class="modal-content forgot" style="padding:2rem 4rem; max-width:520px;">
    <button class="modal-close" onclick="closeModal('forgotModal')">&times;</button>
    <h2 style="text-align:center; margin-bottom:1rem; color: var(--primary-dark);">Forgot Password</h2>

    <div id="forgotStep1">
      <p style="color:#666; margin-bottom:1rem;">Enter the email associated with your account. If it exists, you can reset your password below.</p>
      <form id="forgotForm" class="payment-form">
        <div class="form-group">
          <label for="forgotEmail">Email</label>
          <input type="email" id="forgotEmail" name="forgotEmail" required>
        </div>
        <button type="submit" class="primary-btn" style="width:100%; margin-top:1rem;">Find Account</button>
      </form>
    </div>

    <div id="forgotStep2" style="display:none;">
      <p id="forgotFoundMsg" style="color:var(--primary-dark); font-weight:600;"></p>
      <form id="resetForm" class="payment-form">
        <div class="form-group">
          <label for="resetPassword">New Password *</label>
          <input type="password" id="resetPassword" name="resetPassword" required minlength="6">
        </div>
        <div class="form-group">
          <label for="resetConfirmPassword">Confirm New Password *</label>
          <input type="password" id="resetConfirmPassword" name="resetConfirmPassword" required minlength="6">
        </div>
        <button type="submit" class="primary-btn" style="width:100%; margin-top:1rem;">Set New Password</button>
      </form>
      <div style="text-align:center; margin-top:0.75rem;">
        <a href="#" style="color:var(--primary-gold); text-decoration:none;" onclick="closeModal('forgotModal'); openModal('clientPortalModal')">Back to Login</a>
      </div>
    </div>
  </div>
</div>

    <div id="emergencyModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('emergencyModal')">&times;</button>
            <h2 style="text-align: center; margin-bottom: 2rem; color: var(--primary-dark);">24/7 Emergency Legal Hotline</h2>
            <div style="text-align: center;">
                <div style="background: #f8f9fa; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                    <i class="fas fa-phone-alt" style="font-size: 3rem; color: var(--primary-gold); margin-bottom: 1rem;"></i>
                    <h3 style="font-size: 2rem; color: var(--primary-dark); margin-bottom: 1rem;">+1 (212) 555-0123</h3>
                    <p style="color: #666; font-size: 1.1rem;">Available 24/7 for urgent legal matters</p>
                </div>
                <div style="text-align: left;">
                    <h4 style="color: var(--primary-dark); margin-bottom: 1rem;">Emergency Legal Services Include:</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid #eee;"><i class="fas fa-check" style="color: var(--success-green); margin-right: 1rem;"></i> Immediate injunctive relief</li>
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid #eee;"><i class="fas fa-check" style="color: var(--success-green); margin-right: 1rem;"></i> Crisis management counsel</li>
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid #eee;"><i class="fas fa-check" style="color: var(--success-green); margin-right: 1rem;"></i> Regulatory compliance emergencies</li>
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid #eee;"><i class="fas fa-check" style="color: var(--success-green); margin-right: 1rem;"></i> Executive legal protection</li>
                        <li style="padding: 0.5rem 0;"><i class="fas fa-check" style="color: var(--success-green); margin-right: 1rem;"></i> International legal emergencies</li>
                    </ul>
                </div>
                <button class="primary-btn" style="width: 100%; margin-top: 2rem;" onclick="window.open('tel:+12125550123')">
                    Call Now
                </button>
            </div>
        </div>
    </div>

    <!-- Chat Widget -->
  <!-- Advanced AI Chat Widget -->
<div class="chat-widget">
   <button class="chat-toggle" onclick="toggleChat()">
    <span class="chat-icon">💬</span>
    <span class="chat-pulse"></span>
</button>

    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <div class="chat-header-content">
                <div class="chat-avatar">🔍
                    <i class="fas fa-robot"></i>
                </div>
                <div class="chat-header-text">
                    <span class="chat-title">Elite AI Assistant</span>
                    <span class="chat-status">Online • Ready to help</span>
                </div>
                <button class="chat-minimize" onclick="toggleChat()">❌
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot welcome-message">
                <div class="message-avatar">
                    <i class="fas fa-scales-justice"></i>
                </div>
                <div class="message-content">
                    <div class="message-text">Welcome to Elite Legal Authority! I'm your AI legal assistant. How can I help you today?</div>
                    <div class="message-time">Just now</div>
                </div>
            </div>
        </div>
        <div class="chat-input-container">
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span class="typing-text">AI is typing...</span>
            </div>
            <div class="chat-input-wrapper">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about legal services..." onkeypress="handleChatKeypress(event)">
                <button class="chat-send-btn" onclick="sendChatMessage()">🡅
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

    <footer style="background: var(--primary-dark); color: var(--text-light); padding: 60px 0 30px; position: relative;">
        <div class="container">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 3rem; margin-bottom: 3rem;">
                <div>
                    <h3 style="color: var(--primary-gold); margin-bottom: 1.5rem; font-size: 1.2rem;">Practice Areas</h3>
                    <ul style="list-style: none;">
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Corporate Law & M&A</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">International Trade</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Securities & Finance</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Intellectual Property</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Commercial Litigation</a></li>
                    </ul>
                </div>
                <div>
                    <h3 style="color: var(--primary-gold); margin-bottom: 1.5rem; font-size: 1.2rem;">Global Offices</h3>
                    <ul style="list-style: none;">
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">New York</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">London</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Hong Kong</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Singapore</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Frankfurt</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Tokyo</a></li>
                    </ul>
                </div>
                <div>
                    <h3 style="color: var(--primary-gold); margin-bottom: 1.5rem; font-size: 1.2rem;">Resources</h3>
                    <ul style="list-style: none;">
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Legal Insights</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Market Analysis</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Client Portal</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Careers</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">News & Events</a></li>
                    </ul>
                </div>
                <div>
                    <h3 style="color: var(--primary-gold); margin-bottom: 1.5rem; font-size: 1.2rem;">Contact</h3>
                    <ul style="list-style: none;">
                        <li style="margin-bottom: 0.8rem;"><a href="tel:+12125550123" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">+1 (212) 555-0123</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="mailto:info@elitelegal.com" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">info@elitelegal.com</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Client Portal Login</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Emergency Hotline</a></li>
                        <li style="margin-bottom: 0.8rem;"><a href="#" style="color: var(--text-light); text-decoration: none; opacity: 0.8; transition: all 0.3s ease;">Schedule Consultation</a></li>
                    </ul>
                </div>
            </div>
            <div style="border-top: 1px solid rgba(212, 175, 55, 0.2); padding-top: 2rem; text-align: center; opacity: 0.7;">
                <p>&copy; 2025 Elite Legal Authority. All rights reserved. | Attorney Advertising | Privacy Policy | Terms of Service</p>
            </div>
        </div>
    </footer>

    <!-- Theme Selector -->
    <div class="theme-selector" style="position: fixed; top: 50%; right: 20px; transform: translateY(-50%); z-index: 5000; background: white; border-radius: 50px; padding: 10px; box-shadow: var(--shadow-premium); display: flex; flex-direction: column; gap: 10px;">
        <button class="theme-btn" onclick="changeTheme('default')" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ccc; background: linear-gradient(135deg, #D4AF37 0%, #1a1a2e 100%); cursor: pointer; transition: all 0.3s ease;" title="Classic Gold"></button>
        <button class="theme-btn" onclick="changeTheme('blue')" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ccc; background: linear-gradient(135deg, #4285F4 0%, #1a2e4a 100%); cursor: pointer; transition: all 0.3s ease;" title="Professional Blue"></button>
        <button class="theme-btn" onclick="changeTheme('purple')" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ccc; background: linear-gradient(135deg, #8B5CF6 0%, #2e1a4a 100%); cursor: pointer; transition: all 0.3s ease;" title="Executive Purple"></button>
        <button class="theme-btn" onclick="changeTheme('green')" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ccc; background: linear-gradient(135deg, #10B981 0%, #1a4a2e 100%); cursor: pointer; transition: all 0.3s ease;" title="Corporate Green"></button>
        <button class="theme-btn" onclick="changeTheme('red')" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ccc; background: linear-gradient(135deg, #EF4444 0%, #4a1a1a 100%); cursor: pointer; transition: all 0.3s ease;" title="Power Red"></button>
    </div>

<div id="sessionWarning" class="modal">
        <div class="modal-content" style="text-align: center; max-width: 450px;">
            <h2 style="color: var(--danger-red); margin-bottom: 1rem;">⚠️ Session Expiring</h2>
            <p style="margin-bottom: 2rem;">Your session will expire in <span id="countdown" style="font-weight: bold; color: var(--danger-red);">20</span> seconds.</p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button id="extendSessionBtn" class="primary-btn" onclick="extendSession()">Extend Session</button>
                <button class="primary-btn" onclick="endSession()">End Session</button>
            </div>
            <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #eee;">
                <p style="margin-bottom: 1rem; color: var(--text-dark);">Click the button below to complete your purchase</p>
                <div id="purchaseSection">
                   <button id="buyPageBtn" class="primary-btn"
        onclick="goToHtmlPage()"
        style="background: var(--primary-gold); color: white;">
  💻 Buy Landing Page - $5
</button>


                </div>
            </div>
        </div>
    </div>
  <div id="tourModal" aria-hidden="true">
  <div class="backdrop" data-tour-close></div>
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="tourModalTitle">
    <div class="header">
      <h3 id="tourModalTitle">Tour</h3>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="tour-note" id="tourModalBadge"></div>
        <button class="tour-action ghost" data-tour-close aria-label="Close">✕</button>
      </div>
    </div>

    <div class="meta" id="tourModalMeta">Section / element info</div>

    <div class="colors" id="tourModalColors" aria-hidden="true">
      <!-- color swatches inserted here -->
    </div>

    <div class="body" id="tourModalBody">Explanation text goes here. What happens when the user clicks the button etc.</div>

    <div class="footer">
      <button class="tour-action ghost" id="tourModalSimulate">Simulate</button>
      <button class="tour-action ghost" id="tourModalOpenReal">Open real</button>
      <button class="tour-action primary" id="tourModalClose">Close</button>
    </div>
  </div>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=ARjRdV8XjYuk8l5ykSyKTXYaGGQA9LOfzBtl84LyeQVb5_J5yKG8I-nCB_AhqKqp5H3AhPnStjvgdBHr&currency=USD"></script>

<script>
/*
  Consolidated script:
  - PayPal helpers + dynamic loader
  - Theme management
  - Session timer
  - Payment integration (initializePayPal, processPaymentSuccess)
  - Form handlers (consultation, login, register, forgot, reset)
  - Page utilities (alerts, scrolling, counters, observer)
  - Full in-page chat assistant (button-driven flows, appointment booking, account management)
*/


/* ======================
   PAYPAL - dynamic loader
   ====================== */
  // new function name so it doesn’t clash with existing code
  function goToHtmlPage() {
    window.location.href = "index.html#templates";
  }



const PAYPAL_CLIENT_ID = 'ARjRdV8XjYuk8l5ykSyKTXYaGGQA9LOfzBtl84LyeQVb5_J5yKG8I-nCB_AhqKqp5H3AhPnStjvgdBHr';

function injectPayPalSdkScript(clientId, currency = 'USD') {
    try {
        if (!clientId) return;
        if (window.paypal) return; // already present
        if (document.querySelector(`script[src*="paypal.com/sdk/js?client-id="]`)) return; // already added

        const s = document.createElement('script');
        s.src = `https://www.paypal.com/sdk/js?client-id=${encodeURIComponent(clientId)}&currency=${encodeURIComponent(currency)}`;
        s.async = true;
        s.onload = () => console.log('PayPal SDK injected and loaded.');
        s.onerror = () => console.error('Failed to inject PayPal SDK.');
        document.head.appendChild(s);
    } catch (e) {
        console.error('injectPayPalSdkScript error:', e);
    }
}

function loadPayPalSdk(clientId, currency = 'USD') {
    return new Promise((resolve, reject) => {
        try {
            if (!clientId) return reject(new Error('No PayPal client ID provided.'));
            if (window.paypal) return resolve(window.paypal);

            const existing = document.querySelector(`script[src*="paypal.com/sdk/js?client-id="]`);
            if (existing) {
                existing.addEventListener('load', () => resolve(window.paypal));
                existing.addEventListener('error', () => reject(new Error('Failed to load PayPal SDK.')));
                return;
            }

            const s = document.createElement('script');
            s.src = `https://www.paypal.com/sdk/js?client-id=${encodeURIComponent(clientId)}&currency=${encodeURIComponent(currency)}`;
            s.async = true;
            s.onload = () => resolve(window.paypal);
            s.onerror = () => reject(new Error('Failed to load PayPal SDK.'));
            document.head.appendChild(s);
        } catch (err) {
            reject(err);
        }
    });
}

function initializePayPalWhenReady() {
    if (window.paypal) {
        try {
            initializePayPal();
        } catch (e) {
            console.error('initializePayPal threw an error:', e);
        }
        return;
    }

    // Inject the SDK (we have a valid client id)
    if (PAYPAL_CLIENT_ID) {
        injectPayPalSdkScript(PAYPAL_CLIENT_ID);
        loadPayPalSdk(PAYPAL_CLIENT_ID).then(() => {
            try {
                initializePayPal();
            } catch (e) {
                console.error('initializePayPal threw after SDK load:', e);
            }
        }).catch(err => {
            console.error('Could not load PayPal SDK:', err);
        });
    } else {
        console.warn('PAYPAL_CLIENT_ID not set. Add SDK script tag or set PAYPAL_CLIENT_ID.');
    }
}

/* ======================
   THEME MANAGEMENT
   ====================== */
const themes = {
    default: {
        primaryGold: '#D4AF37',
        primaryDark: '#1a1a2e',
        primaryNavy: '#16213e',
        accentBlue: '#0f3460',
        textLight: '#f8f9fa',
        textDark: '#2c3e50',
        gradientGold: 'linear-gradient(135deg, #D4AF37 0%, #FFD700 50%, #B8860B 100%)',
        gradientDark: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)'
    },
    blue: {
        primaryGold: '#4285F4',
        primaryDark: '#1a2e4a',
        primaryNavy: '#163e54',
        accentBlue: '#0f4060',
        textLight: '#f8f9fa',
        textDark: '#2c3e50',
        gradientGold: 'linear-gradient(135deg, #4285F4 0%, #5A9FFF 50%, #2563EB 100%)',
        gradientDark: 'linear-gradient(135deg, #1a2e4a 0%, #163e54 50%, #0f4060 100%)'
    },
    purple: {
        primaryGold: '#8B5CF6',
        primaryDark: '#2e1a4a',
        primaryNavy: '#3e1654',
        accentBlue: '#4c0f60',
        textLight: '#f8f9fa',
        textDark: '#2c3e50',
        gradientGold: 'linear-gradient(135deg, #8B5CF6 0%, #A78BFA 50%, #7C3AED 100%)',
        gradientDark: 'linear-gradient(135deg, #2e1a4a 0%, #3e1654 50%, #4c0f60 100%)'
    },
    green: {
        primaryGold: '#10B981',
        primaryDark: '#1a4a2e',
        primaryNavy: '#165432',
        accentBlue: '#0f6040',
        textLight: '#f8f9fa',
        textDark: '#2c3e50',
        gradientGold: 'linear-gradient(135deg, #10B981 0%, #34D399 50%, #059669 100%)',
        gradientDark: 'linear-gradient(135deg, #1a4a2e 0%, #165432 50%, #0f6040 100%)'
    },
    red: {
        primaryGold: '#EF4444',
        primaryDark: '#4a1a1a',
        primaryNavy: '#541616',
        accentBlue: '#600f0f',
        textLight: '#f8f9fa',
        textDark: '#2c3e50',
        gradientGold: 'linear-gradient(135deg, #EF4444 0%, #F87171 50%, #DC2626 100%)',
        gradientDark: 'linear-gradient(135deg, #4a1a1a 0%, #541616 50%, #600f0f 100%)'
    }
};

function changeTheme(themeName, targetBtn = null) {
    const theme = themes[themeName];
    if (!theme) return;

    const root = document.documentElement;
    Object.entries(theme).forEach(([key, value]) => {
        const cssVar = '--' + key.replace(/[A-Z]/g, letter => `-${letter.toLowerCase()}`);
        root.style.setProperty(cssVar, value);
    });

    // Update theme selector active state (reset first)
    document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.style.border = '2px solid #ccc';
    });

    try {
        if (targetBtn && targetBtn instanceof Element) {
            targetBtn.style.border = '3px solid ' + theme.primaryGold;
        } else {
            const fallbackBtn = document.querySelector(`.theme-btn[data-theme="${themeName}"]`);
            if (fallbackBtn) fallbackBtn.style.border = '3px solid ' + theme.primaryGold;
        }
    } catch (err) {
        console.warn('changeTheme: could not set active button border', err);
    }

    localStorage.setItem('selectedTheme', themeName);

    try {
        if (theme.primaryGold) {
            if (typeof window.setPlateletColor === 'function') {
                window.setPlateletColor(theme.primaryGold);
            } else {
                root.style.setProperty('--primary-gold', theme.primaryGold);
                root.style.setProperty('--gradient-gold', theme.gradientGold || theme.primaryGold);
            }
        }
    } catch (e) {
        console.warn('changeTheme: platelet sync failed', e);
    }

    showAlert('Theme changed successfully!', 'success');
}

/* Provide a small wrapper used elsewhere */
function setTheme(name) { changeTheme(name); }

/* ======================
   SESSION TIMER
   ====================== */
let sessionTimer;
let countdownTimer;
let sessionTimeLeft = 20; // display in UI
let warningShown = false;

function startSessionTimer() {
    clearTimeout(sessionTimer);
    sessionTimer = setTimeout(() => {
        showSessionWarning();
    }, 20000); // show warning at 40s (so 50s demo)
}

function showSessionWarning() {
    if (warningShown) return;
    warningShown = true;

    const modal = document.getElementById('sessionWarning');
    if (modal) modal.classList.add('active');

    countdownTimer = setInterval(() => {
        sessionTimeLeft--;
        const el = document.getElementById('countdown');
        if (el) el.textContent = sessionTimeLeft;

        if (sessionTimeLeft <= 0) {
            endSession();
        }
    }, 1000);
}

function extendSession() {
    clearTimeout(sessionTimer);
    clearInterval(countdownTimer);
    sessionTimeLeft = 10;
    warningShown = false;
    const modal = document.getElementById('sessionWarning');
    if (modal) modal.classList.remove('active');
    startSessionTimer();
    showAlert('Session extended successfully!', 'success');
}

function endSession() {
    clearTimeout(sessionTimer);
    clearInterval(countdownTimer);
    showAlert('Session ended. Redirecting...', 'warning');
    setTimeout(() => {
        window.location.href = 'index.html';
    }, 1200);
}

/* ======================
   GLOBAL STATE
   ====================== */
let currentUser = null;
let paymentData = {};
let chatMessages = [];

/* ======================
   MODAL HELPERS
   ====================== */
function openModal(modalId) {
    const el = document.getElementById(modalId);
    if (el) el.classList.add('active');
}
function closeModal(modalId) {
    const el = document.getElementById(modalId);
    if (el) el.classList.remove('active');
}

/* ======================
   PAYMENT: openPaymentModal + initializePayPal + processPaymentSuccess
   ====================== */
function openPaymentModal(planType, amount) {
    paymentData = { planType, amount };

    const planNames = {
        consultation: 'Legal Consultation',
        business: 'Business Legal Plan',
        enterprise: 'Enterprise Legal Plan'
    };

    const paymentDetails = `
        <div class="alert" style="background: rgba(212, 175, 55, 0.1); border-left-color: var(--primary-gold); color: var(--primary-gold);">
            <h3>${planNames[planType] || planType}</h3>
            <p><strong>Amount: ${amount.toLocaleString()}</strong></p>
            <p>${planType === 'consultation' ? 'One-time payment' : 'Monthly subscription'}</p>
        </div>
    `;

    const pd = document.getElementById('paymentDetails');
    if (pd) pd.innerHTML = paymentDetails;
    openModal('paymentModal');

    // Ensure PayPal is ready and initialize
    if (window.paypal) {
        initializePayPal();
    } else {
        loadPayPalSdk(PAYPAL_CLIENT_ID).then(() => {
            initializePayPal();
        }).catch(err => {
            console.error('Unable to load PayPal SDK:', err);
            showAlert('Payment unavailable: PayPal SDK failed to load.', 'error');
        });
    }
}

function initializePayPal() {
    const container = document.getElementById('purchasePayPalContainer') || document.getElementById('paypal-button-container');
    if (!container) {
        console.warn('PayPal button container not found. Add id="purchasePayPalContainer" or id="paypal-button-container".');
        return;
    }
    container.innerHTML = '';

    if (!window.paypal) {
        console.warn('PayPal SDK not present when initializing buttons.');
        return;
    }

    paypal.Buttons({
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: { value: (paymentData.amount || 0).toString() },
                    description: `Elite Legal Authority - ${paymentData.planType}`
                }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                showAlert('Payment successful! Welcome to Elite Legal Authority.', 'success');
                processPaymentSuccess(details);
                closeModal('paymentModal');
            });
        },
        onError: function(err) {
            console.error('PayPal Error:', err);
            showAlert('Payment failed. Please try again.', 'error');
        },
        onCancel: function(data) {
            showAlert('Payment cancelled.', 'warning');
        }
    }).render('#paypal-button-container');
}

function processPaymentSuccess(details) {
    // Build client data from payment form inputs (if present)
    const first = document.getElementById('payFirstName')?.value || '';
    const last = document.getElementById('payLastName')?.value || '';
    const email = document.getElementById('payEmail')?.value || '';
    const clientData = {
        name: `${first} ${last}`.trim(),
        email: email,
        plan: paymentData.planType,
        amount: paymentData.amount,
        paymentId: details.id,
        status: 'active',
        startDate: new Date().toISOString()
    };

    localStorage.setItem('clientAccount', JSON.stringify(clientData));
    currentUser = clientData;

    setTimeout(() => {
        showAlert('Confirmation email sent! Check your inbox.', 'success');
    }, 800);
}

/* ======================
   CHAT ASSISTANT (rich)
   - addChatMessage supports HTML
   - quick actions, appointment flow, account flow, password reset, theme change, exit
   ====================== */

const SUPPORT_EMAIL = 'info@elitelegal.com'; // change if you want to receive mailto appointments
const APP_NAME = 'Elite Legal Authority';

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

/* Unified addChatMessage: content can be plain text or HTML via asHTML flag */
function addChatMessage(content, sender = 'bot', asHTML = false) {
    const messagesContainer = document.getElementById('chatMessages');
    if (!messagesContainer) return;
    const div = document.createElement('div');
    div.className = `message ${sender}`;
    if (asHTML) div.innerHTML = content;
    else div.textContent = content;
    messagesContainer.appendChild(div);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    chatMessages.push({ message: content, sender, timestamp: new Date().toISOString() });
}

/* Quick actions rendered inside chat */
// REPLACE your existing renderQuickActions() with this function:
function renderQuickActions() {
  const messagesContainer = document.getElementById('chatMessages');
  if (!messagesContainer) return;

  // remove any previous quick-action nodes we created earlier to avoid duplicates
  const prev = messagesContainer.querySelector('.chat-quick-actions');
  if (prev) prev.remove();

  // wrapper message node
  const wrapper = document.createElement('div');
  wrapper.className = 'message bot chat-quick-actions';
  wrapper.style.display = 'flex';
  wrapper.style.flexDirection = 'column';
  wrapper.style.gap = '8px';
  wrapper.style.padding = '8px 6px';

  // heading
  const heading = document.createElement('div');
  heading.textContent = 'Hi — how can I help you today?';
  heading.style.fontWeight = '600';
  heading.style.marginBottom = '6px';
  heading.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-dark') || '#222';
  wrapper.appendChild(heading);

  // grid of main buttons
  const grid = document.createElement('div');
  grid.style.display = 'grid';
  grid.style.gridTemplateColumns = '1fr 1fr';
  grid.style.gap = '6px';

  const btnMakeAppt = document.createElement('button');
  btnMakeAppt.className = 'primary-btn';
  btnMakeAppt.type = 'button';
  btnMakeAppt.textContent = 'Make Appointment';
  btnMakeAppt.style.padding = '8px';
  btnMakeAppt.onclick = startAppointmentFlow;
  grid.appendChild(btnMakeAppt);

  const btnAccount = document.createElement('button');
  btnAccount.className = 'primary-btn';
  btnAccount.type = 'button';
  // label decided at runtime
  try {
    btnAccount.textContent = loadAccount() ? 'My Account' : 'Create Account';
  } catch (e) {
    btnAccount.textContent = 'Create Account';
  }
  btnAccount.style.padding = '8px';
  btnAccount.onclick = startAccountFlow;
  grid.appendChild(btnAccount);

  const btnOpenForm = document.createElement('button');
  btnOpenForm.className = 'secondary-btn';
  btnOpenForm.type = 'button';
  btnOpenForm.textContent = 'Open Consultation Form';
  btnOpenForm.style.padding = '8px';
  btnOpenForm.onclick = () => openModal('consultationModal');
  grid.appendChild(btnOpenForm);

  const btnExplore = document.createElement('button');
  btnExplore.className = 'secondary-btn';
  btnExplore.type = 'button';
  btnExplore.textContent = 'Explore Services';
  btnExplore.style.padding = '8px';
  btnExplore.onclick = showServicesFromChat;
  grid.appendChild(btnExplore);

  wrapper.appendChild(grid);

  // bottom row: color + exit
  const bottomRow = document.createElement('div');
  bottomRow.style.display = 'flex';
  bottomRow.style.gap = '6px';
  bottomRow.style.marginTop = '6px';

  const btnColor = document.createElement('button');
  btnColor.className = 'secondary-btn';
  btnColor.type = 'button';
  btnColor.textContent = 'Change Colour';
  btnColor.style.padding = '6px 8px';
  btnColor.onclick = showColorPicker;
  bottomRow.appendChild(btnColor);

 

  wrapper.appendChild(bottomRow);

  // append and scroll into view
  messagesContainer.appendChild(wrapper);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;

  // keep a log in chatMessages array (optional)
  try {
    chatMessages.push({ message: 'quick-actions-rendered', sender: 'bot', timestamp: new Date().toISOString() });
  } catch (e) { /* silent */ }
}

/* Chat toggle & input handling */
function toggleChat() {
    const chatWindow = document.getElementById('chatWindow');
    if (!chatWindow) return;
    chatWindow.classList.toggle('active');
    if (chatWindow.classList.contains('active')) {
        const input = document.getElementById('chatInput');
        input && input.focus();
        setTimeout(() => renderQuickActions(), 150);
    }
}

function handleChatKeypress(event) {
    if (event.key === 'Enter') sendChatMessage();
}

/* Main chat send: simple routing */
function sendChatMessage() {
    const input = document.getElementById('chatInput');
    if (!input) return;
    const text = input.value.trim();
    if (!text) return;
    addChatMessage(text, 'user', false);
    input.value = '';

    const t = text.toLowerCase();
    if (t.includes('appointment') || t.includes('book')) {
        setTimeout(() => startAppointmentFlow(), 400);
        return;
    }
    if (t.includes('account') || t.includes('register') || t.includes('create')) {
        setTimeout(() => startAccountFlow(), 400);
        return;
    }
    if (t.includes('password') || t.includes('reset')) {
        setTimeout(() => startPasswordResetFlow(), 400);
        return;
    }
    if (t.includes('services') || t.includes('what') || t.includes('areas')) {
        setTimeout(() => showServicesFromChat(), 400);
        return;
    }

    setTimeout(() => {
        addChatMessage("Thanks — I can help with: Book appointment, Create account, Reset password, Explore services. Or click a button below.", 'bot', false);
        renderQuickActions();
    }, 700);
}

/* Appointment flow inside chat */
function escapeHtml(s) {
    if (!s) return '';
    return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]));
}

function startAppointmentFlow() {
    const account = loadAccount();
    const suggestedName = account ? `${account.firstName || ''} ${account.lastName || ''}`.trim() : '';
    const suggestedEmail = account ? account.email : '';
    const html = `
    <form id="chatApptForm" style="display:flex;flex-direction:column;gap:8px;">
      <label style="font-weight:600">Book a consultation</label>
      <input required name="name" placeholder="Full name" value="${escapeHtml(suggestedName)}" />
      <input required name="email" placeholder="Email" value="${escapeHtml(suggestedEmail)}" />
      <select name="legalArea" required>
        <option value="">Select legal area</option>
        <option value="Corporate Law & M&A">Corporate Law & M&A</option>
        <option value="International Trade">International Trade</option>
        <option value="Securities & Finance">Securities & Finance</option>
        <option value="Intellectual Property">Intellectual Property</option>
        <option value="Commercial Litigation">Commercial Litigation</option>
        <option value="Executive Advisory">Executive Advisory</option>
        <option value="Other">Other</option>
      </select>
      <input name="date" type="date" required />
      <input name="time" type="time" required />
      <select name="urgency" required>
        <option value="routine">Routine (1-2 weeks)</option>
        <option value="urgent">Urgent (3-5 days)</option>
        <option value="critical">Critical (24-48 hours)</option>
        <option value="emergency">Emergency (Same day)</option>
      </select>
      <textarea name="notes" placeholder="Short description (optional)"></textarea>
      <div style="display:flex;gap:8px;">
        <button type="button" class="primary-btn" onclick="submitChatAppointment()">Confirm</button>
        <button type="button" class="secondary-btn" onclick="renderQuickActions()">Cancel</button>
      </div>
    </form>
  `;
    addChatMessage(html, 'bot', true);
    setTimeout(() => {
        const form = document.querySelector('#chatMessages form#chatApptForm');
        form && form.querySelector('input[name="name"]').focus();
    }, 120);
}

function submitChatAppointment() {
    const form = document.querySelector('#chatMessages form#chatApptForm');
    if (!form) { addChatMessage('No appointment form found.', 'bot'); return; }
    const fd = new FormData(form);
    const data = Object.fromEntries(fd.entries());
    if (!data.name || !data.email || !data.date || !data.time || !data.legalArea) {
        addChatMessage('Please fill all required fields.', 'bot');
        return;
    }
    if (!isValidEmail(data.email)) { addChatMessage('Please enter a valid email.', 'bot'); return; }

    const appt = {
        id: 'APPT' + Date.now(),
        name: data.name,
        email: data.email,
        legalArea: data.legalArea,
        date: data.date,
        time: data.time,
        urgency: data.urgency || 'routine',
        notes: data.notes || '',
        createdAt: new Date().toISOString(),
        status: 'pending'
    };

    // Save locally (demo)
    const arr = JSON.parse(localStorage.getItem('appointments') || '[]');
    arr.push(appt);
    localStorage.setItem('appointments', JSON.stringify(arr));

    addChatMessage('Appointment saved locally. Preparing confirmation email...', 'bot');

    const subject = `${APP_NAME} - New Consultation Request (${appt.legalArea})`;
    const body = `Name: ${appt.name}
Email: ${appt.email}
Area: ${appt.legalArea}
Date: ${appt.date}
Time: ${appt.time}
Urgency: ${appt.urgency}
Notes: ${appt.notes}
ID: ${appt.id}
Submitted: ${appt.createdAt}
`;
    const mailto = `mailto:${encodeURIComponent(SUPPORT_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

    setTimeout(() => {
        addChatMessage('Opening your email client to send the appointment to our team. (Demo)', 'bot');
        window.open(mailto, '_blank');
    }, 600);

    setTimeout(() => {
        addChatMessage('Appointment request submitted — we will contact you with confirmation. Would you like to pay now to secure the slot?', 'bot');
        addChatMessage('<div style="display:flex;gap:6px;"><button class="primary-btn" onclick="openPaymentFromChat()">Pay Now</button><button class="secondary-btn" onclick="renderQuickActions()">No, thanks</button></div>', 'bot', true);
    }, 1200);
}

function openPaymentFromChat() {
    const pending = JSON.parse(localStorage.getItem('appointments') || '[]').slice(-1)[0];
    if (!pending) {
        addChatMessage('No pending appointment found to pay for.', 'bot');
        return;
    }
    const feeMap = { routine: 500, urgent: 750, critical: 1000, emergency: 1500 };
    const fee = feeMap[pending.urgency] || 500;
    if (typeof openPaymentModal === 'function') openPaymentModal('consultation', fee);
    else addChatMessage(`Please pay $${fee} via the payment modal. (Payment helper not found.)`, 'bot');
}

/* Account flows in chat */
function saveAccount(account) {
    localStorage.setItem('clientAccount', JSON.stringify(account));
}
function loadAccount() {
    const raw = localStorage.getItem('clientAccount');
    return raw ? JSON.parse(raw) : null;
}

function startAccountFlow() {
    const account = loadAccount();
    if (account) {
        addChatMessage(`<div style="font-weight:600">${escapeHtml(account.firstName || '')} — you are recognized (demo).</div>
      <div style="display:flex;gap:6px;">
        <button class="primary-btn" onclick="showClientDashboardFromChat()">Open Dashboard</button>
        <button class="secondary-btn" onclick="startPasswordResetFlow()">Change Password</button>
        <button class="secondary-btn" onclick="renderQuickActions()">Back</button>
      </div>`, 'bot', true);
        return;
    }

    const html = `
    <form id="chatRegisterForm" style="display:flex;flex-direction:column;gap:8px;">
      <label style="font-weight:600;">Create account (demo)</label>
      <input name="firstName" placeholder="First name" />
      <input name="lastName" placeholder="Last name" />
      <input name="email" placeholder="Email" />
      <input name="password" type="password" placeholder="Password (min 6 chars)" />
      <div style="display:flex;gap:8px;">
        <button type="button" class="primary-btn" onclick="submitChatRegister()">Create</button>
        <button type="button" class="secondary-btn" onclick="renderQuickActions()">Cancel</button>
      </div>
    </form>
  `;
    addChatMessage(html, 'bot', true);
}

function submitChatRegister() {
    const form = document.querySelector('#chatMessages form#chatRegisterForm');
    if (!form) return addChatMessage('Register form missing.', 'bot');
    const data = Object.fromEntries(new FormData(form).entries());
    if (!data.email || !data.firstName || !data.password) return addChatMessage('Please fill name, email and password.', 'bot');
    if (!isValidEmail(data.email)) return addChatMessage('Enter a valid email.', 'bot');
    if (data.password.length < 6) return addChatMessage('Password too short.', 'bot');

    const account = { firstName: data.firstName, lastName: data.lastName, email: data.email.toLowerCase(), password: data.password, createdAt: new Date().toISOString() };
    saveAccount(account);
    currentUser = account;
    addChatMessage('Account created (demo). You are now signed in.', 'bot');
    setTimeout(() => renderQuickActions(), 600);
}

/* Password reset in chat */
function startPasswordResetFlow() {
    const html = `
    <form id="chatResetForm" style="display:flex;flex-direction:column;gap:8px;">
      <label style="font-weight:600;">Reset password (demo)</label>
      <input name="email" placeholder="Email" />
      <input name="newPassword" type="password" placeholder="New password" />
      <input name="confirmPassword" type="password" placeholder="Confirm password" />
      <div style="display:flex;gap:8px;">
        <button type="button" class="primary-btn" onclick="submitChatReset()">Set Password</button>
        <button type="button" class="secondary-btn" onclick="renderQuickActions()">Cancel</button>
      </div>
    </form>
  `;
    addChatMessage(html, 'bot', true);
}

function submitChatReset() {
    const form = document.querySelector('#chatMessages form#chatResetForm');
    if (!form) return addChatMessage('Reset form missing', 'bot');
    const d = Object.fromEntries(new FormData(form).entries());
    const email = (d.email || '').toLowerCase();
    if (!isValidEmail(email)) return addChatMessage('Enter a valid email.', 'bot');
    if (!d.newPassword || d.newPassword.length < 6) return addChatMessage('Password must be at least 6 chars.', 'bot');
    if (d.newPassword !== d.confirmPassword) return addChatMessage('Passwords do not match.', 'bot');

    const account = loadAccount();
    if (account && account.email === email) {
        account.password = d.newPassword;
        saveAccount(account);
        addChatMessage('Password updated (demo). You can now log in.', 'bot');
        return setTimeout(() => renderQuickActions(), 600);
    } else {
        addChatMessage('Account not found (demo). You can create an account instead.', 'bot');
        setTimeout(() => startAccountFlow(), 600);
    }
}

function showClientDashboardFromChat() {
    const account = loadAccount();
    if (!account) return addChatMessage('Not signed in (demo).', 'bot');
    addChatMessage(`Hello ${escapeHtml(account.firstName)} — opening a demo dashboard...`, 'bot');
    setTimeout(() => {
        alert(`Demo Dashboard\n\nName: ${account.firstName} ${account.lastName}\nEmail: ${account.email}\nCreated: ${account.createdAt}\n\n(This is a demo; real dashboards are implemented server-side.)`);
    }, 600);
}

function showServicesFromChat() {
    const html = `
    <div style="display:flex;flex-direction:column;gap:8px;">
      <div style="font-weight:600;">Our main practice areas</div>
      <ul style="margin-left:12px;">
        <li>Corporate Law & M&A</li>
        <li>International Trade</li>
        <li>Securities & Finance</li>
        <li>Intellectual Property</li>
        <li>Commercial Litigation</li>
        <li>Executive Advisory</li>
      </ul>
      <div style="display:flex;gap:6px;">
        <button class="primary-btn" onclick="openModal('consultationModal')">Schedule Consultation</button>
        <button class="secondary-btn" onclick="renderQuickActions()">Back</button>
      </div>
    </div>
  `;
    addChatMessage(html, 'bot', true);
}

/* Colour picker in chat */
function showColorPicker() {
    const html = `
    <div style="display:flex;flex-direction:column;gap:8px;">
      <div style="font-weight:600;">Choose a theme accent</div>
      <div style="display:flex;gap:6px;">
        <button class="theme-btn" onclick="setTheme('default')">Gold</button>
        <button class="theme-btn" onclick="setTheme('blue')">Blue</button>
        <button class="theme-btn" onclick="setTheme('green')">Green</button>
        <button class="theme-btn" onclick="setTheme('purple')">Purple</button>
      </div>
      <div style="display:flex;gap:6px;"><button class="secondary-btn" onclick="renderQuickActions()">Back</button></div>
    </div>
  `;
    addChatMessage(html, 'bot', true);
}

/* Exit Chat: hide widget */
function toggleChatExit() {
    const widget = document.querySelector('.chat-widget');
    if (!widget) return;
    widget.style.display = widget.style.display === 'none' ? '' : 'none';
}

/* Inject Exit button in chat header */

/* ======================
   FORM HANDLERS (page-level forms)
   ====================== */

/* Consultation form in modal */
const consultationForm = document.getElementById('consultationForm');
if (consultationForm) {
    consultationForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        if (!validateConsultationForm(data)) return;
        processConsultationRequest(data);
    });
}

function validateConsultationForm(data) {
    const required = ['firstName', 'lastName', 'email', 'legalArea', 'urgency', 'description'];
    const missing = required.filter(field => !data[field]);
    if (missing.length > 0) {
        showAlert(`Please fill in all required fields: ${missing.join(', ')}`, 'error');
        return false;
    }
    if (!isValidEmail(data.email)) {
        showAlert('Please enter a valid email address.', 'error');
        return false;
    }
    return true;
}

function processConsultationRequest(data) {
    const urgencyFees = { routine: 500, urgent: 750, critical: 1000, emergency: 1500 };
    const fee = urgencyFees[data.urgency] || 500;
    const consultation = {
        ...data,
        fee: fee,
        status: 'pending',
        id: 'CONS' + Date.now(),
        submittedAt: new Date().toISOString()
    };
    localStorage.setItem('pendingConsultation', JSON.stringify(consultation));
    showAlert(`Consultation request submitted! Fee: ${fee}. We'll contact you within ${getResponseTime(data.urgency)}.`, 'success');
    closeModal('consultationModal');

    setTimeout(() => {
        if (confirm(`Would you like to pay the consultation fee of ${fee} now to secure your appointment?`)) {
            openPaymentModal('consultation', fee);
        }
    }, 900);
}

function getResponseTime(urgency) {
    const times = {
        routine: '1-2 business days',
        urgent: '4-6 hours',
        critical: '1-2 hours',
        emergency: '30 minutes'
    };
    return times[urgency] || '1-2 business days';
}

/* Login form */
const loginForm = document.getElementById('loginForm');
if (loginForm) {
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim().toLowerCase();
        const password = document.getElementById('loginPassword').value;
        if (!email || !password) { showAlert('Please enter both email and password.', 'error'); return; }
        if (!isValidEmail(email)) { showAlert('Please enter a valid email address.', 'error'); return; }
        if (authenticateUser(email, password)) {
            showClientDashboard();
            closeModal('clientPortalModal');
        } else {
            showAlert('Invalid credentials. Please try again.', 'error');
        }
    });
}

function authenticateUser(email, password) {
    const clientAccount = localStorage.getItem('clientAccount');
    if (clientAccount) {
        try {
            const account = JSON.parse(clientAccount);
            return account.email === email && (!account.password || account.password === password || password === 'demo123');
        } catch (e) { /* ignore */ }
    }
    return email === 'demo@elitelegal.com' && password === 'demo123';
}

function showClientDashboard() {
    showAlert('Successfully logged in! Redirecting to your dashboard...', 'success');
    setTimeout(() => {
        alert('Client Dashboard\n\n• Active Cases: 2\n• Pending Matters: 1\n• Recent Communications: 5\n• Next Appointment: Tomorrow 2:00 PM\n\n[This is a demo - full dashboard would be server-side]');
    }, 900);
}

/* Registration form */
const registerForm = document.getElementById('registerForm');
if (registerForm) {
    registerForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const firstName = document.getElementById('regFirstName').value.trim();
        const lastName = document.getElementById('regLastName').value.trim();
        const email = document.getElementById('regEmail').value.trim().toLowerCase();
        const password = document.getElementById('regPassword').value;
        const confirm = document.getElementById('regConfirmPassword').value;
        const company = document.getElementById('regCompany').value.trim();

        if (!firstName || !lastName || !email || !password || !confirm) { showAlert('Please fill all required fields.', 'error'); return; }
        if (!isValidEmail(email)) { showAlert('Please enter a valid email address.', 'error'); return; }
        if (password.length < 6) { showAlert('Password must be at least 6 characters.', 'error'); return; }
        if (password !== confirm) { showAlert('Passwords do not match.', 'error'); return; }

        const account = { firstName, lastName, email, password, company, createdAt: new Date().toISOString() };
        saveAccount(account);
        showAlert('Account created successfully. You can now log in.', 'success');
        closeModal('registerModal');
        setTimeout(() => openModal('clientPortalModal'), 400);
    });
}

/* Forgot + Reset */
const forgotForm = document.getElementById('forgotForm');
if (forgotForm) {
    forgotForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('forgotEmail').value.trim().toLowerCase();
        if (!email) { showAlert('Enter an email address.', 'error'); return; }
        if (!isValidEmail(email)) { showAlert('Enter a valid email address.', 'error'); return; }

        const account = loadAccount();
        if (!account || account.email !== email) {
            showAlert('If an account exists with that email, you will be able to reset the password now.', 'warning');
            setTimeout(() => { closeModal('forgotModal'); openModal('clientPortalModal'); }, 1600);
            return;
        }

        document.getElementById('forgotStep1').style.display = 'none';
        document.getElementById('forgotFoundMsg').textContent = 'Account found for ' + email + '. Enter a new password below.';
        document.getElementById('forgotStep2').style.display = 'block';
    });
}

const resetForm = document.getElementById('resetForm');
if (resetForm) {
    resetForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const newPass = document.getElementById('resetPassword').value;
        const confirm = document.getElementById('resetConfirmPassword').value;
        if (!newPass || !confirm) { showAlert('Fill in the new password fields.', 'error'); return; }
        if (newPass.length < 6) { showAlert('Password must be at least 6 characters.', 'error'); return; }
        if (newPass !== confirm) { showAlert('Passwords do not match.', 'error'); return; }

        const email = document.getElementById('forgotEmail').value.trim().toLowerCase();
        const account = loadAccount();
        if (account && account.email === email) {
            account.password = newPass;
            saveAccount(account);
            showAlert('Password reset successfully. You may now log in.', 'success');
            closeModal('forgotModal');
            setTimeout(() => openModal('clientPortalModal'), 400);
        } else {
            showAlert('Unable to reset - account not found. Try creating an account.', 'error');
            setTimeout(() => { closeModal('forgotModal'); openModal('registerModal'); }, 1000);
        }
    });
}

/* ======================
   UTILITIES: alerts, scroll, observer, counters
   ====================== */
function showAlert(message, type = 'success') {
    const alert = document.createElement('div');
    alert.className = `alert ${type}`;
    alert.style.cssText = 'position: fixed; top: 90px; right: 20px; z-index: 11000; max-width: 360px;';
    alert.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;"><span>' + message + '</span><button style="background:none;border:none;cursor:pointer;margin-left:1rem;" onclick="this.parentElement.parentElement.remove()">&times;</button></div>';
    document.body.appendChild(alert);
    setTimeout(() => { if (alert.parentElement) alert.remove(); }, 4500);
}

function scrollToSection(sectionId) {
    const element = document.getElementById(sectionId);
    if (element) element.scrollIntoView({ behavior: 'smooth' });
}

const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
            setTimeout(() => { entry.target.classList.add('active'); }, index * 100);
        }
    });
}, observerOptions);

function animateCounter(element, target, duration = 2000) {
    const startTime = performance.now();
    const startValue = 0;
    function updateCounter(currentTime) {
        const elapsedTime = currentTime - startTime;
        const progress = Math.min(elapsedTime / duration, 1);
        const easeOutQuart = 1 - Math.pow(1 - progress, 4);
        const currentValue = startValue + (target - startValue) * easeOutQuart;
        if (target % 1 !== 0) element.textContent = currentValue.toFixed(1);
        else element.textContent = Math.floor(currentValue);
        if (progress < 1) requestAnimationFrame(updateCounter);
    }
    requestAnimationFrame(updateCounter);
}

/* Add slideInRight animation */
(function addSlideInRight() {
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
    `;
    document.head.appendChild(style);
})();

/* ======================
   INITIALIZATION ON LOAD
   ====================== */
window.addEventListener('load', () => {
    const savedTheme = localStorage.getItem('selectedTheme') || 'default';
    if (savedTheme && savedTheme !== 'default') changeTheme(savedTheme);

    startSessionTimer();

    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

    const statsSection = document.querySelector('.stats');
    if (statsSection) {
        const statsObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const statNumbers = entry.target.querySelectorAll('.stat-number');
                    statNumbers.forEach(statNumber => {
                        const target = parseFloat(statNumber.getAttribute('data-target'));
                        animateCounter(statNumber, target, 2500);
                    });
                    statsObserver.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });
        statsObserver.observe(statsSection);
    }

    document.querySelectorAll('.office-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = 'var(--shadow-premium)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 8px 30px rgba(0, 0, 0, 0.06)';
        });
    });

    // Chat initialization: attach input listener and toggle hook
    const chatInput = document.getElementById('chatInput');
    if (chatInput) chatInput.addEventListener('keypress', handleChatKeypress);

    const toggle = document.querySelector('.chat-toggle');
    if (toggle) {
        toggle.addEventListener('click', function() {
            const messages = document.getElementById('chatMessages');
            if (messages) {
                messages.innerHTML = '<div class="message bot">Hello! I\\\'m your legal assistant. How can I help you today?</div>';
            }
            setTimeout(() => renderQuickActions(), 200);
            injectExitButton();
        });
    }

    // Inject PayPal SDK if missing (we already included static script tag, but keep dynamic loader safe)
    if (!window.paypal && PAYPAL_CLIENT_ID) {
        injectPayPalSdkScript(PAYPAL_CLIENT_ID);
    }

    // Make sure global helper names are available for other inline code
    window.toggleChat = toggleChat;
    window.sendChatMessage = sendChatMessage;
    window.handleChatKeypress = handleChatKeypress;
    window.startAppointmentFlow = startAppointmentFlow;
    window.startAccountFlow = startAccountFlow;
    window.startPasswordResetFlow = startPasswordResetFlow;
    window.submitChatAppointment = submitChatAppointment;
    window.submitChatRegister = submitChatRegister;
    window.submitChatReset = submitChatReset;
    window.showServicesFromChat = showServicesFromChat;
    window.setTheme = setTheme;
    window.toggleChatExit = toggleChatExit;
    window.openPaymentFromChat = openPaymentFromChat;
    window.initializePayPalWhenReady = initializePayPalWhenReady;

    console.log('%cElite Legal Authority Platform Loaded', 'color: #D4AF37; font-size: 16px; font-weight: bold;');
});

/* ===== Safety fallback: ensure global currentUser exists ===== */
if (typeof currentUser === 'undefined') window.currentUser = null;

(function(){
  const modal = document.getElementById('tourModal');
  const titleEl = document.getElementById('tourModalTitle');
  const metaEl = document.getElementById('tourModalMeta');
  const colorsEl = document.getElementById('tourModalColors');
  const bodyEl = document.getElementById('tourModalBody');
  const badgeEl = document.getElementById('tourModalBadge');
  const btnSim = document.getElementById('tourModalSimulate');
  const btnOpen = document.getElementById('tourModalOpenReal');
  const btnClose = document.getElementById('tourModalClose');
  const closeTriggers = modal.querySelectorAll('[data-tour-close]');

  // Current context stored so Open Real can act
  let currentContext = null;

  function clearColors(){ colorsEl.innerHTML = ''; colorsEl.style.display='none'; }
  function setColors(fg, bg){
    colorsEl.style.display = 'flex';
    colorsEl.innerHTML = '';
    const make = (label, color) => {
      const s = document.createElement('div'); s.className='tour-swatch';
      s.innerHTML = `<span class="box" style="background:${color}"></span> ${label}: <strong style="margin-left:6px">${color}</strong>`;
      return s;
    };
    colorsEl.appendChild(make('text', fg));
    colorsEl.appendChild(make('background', bg));
  }

  function openTourModal({ title='Preview', meta='', html='', fg='', bg='', badge='', context=null } = {}){
    currentContext = context || null;
    titleEl.textContent = title;
    metaEl.textContent = meta || '';
    bodyEl.innerHTML = html || '';
    badgeEl.textContent = badge || '';
    if (fg || bg) setColors(fg || 'inherit', bg || 'transparent'); else clearColors();
    modal.classList.add('show');
    modal.setAttribute('aria-hidden','false');

    // default button states
    btnSim.style.display = 'inline-block';
    btnOpen.style.display = 'inline-block';
  }

  function closeTourModal(){
    modal.classList.remove('show');
    modal.setAttribute('aria-hidden','true');
    currentContext = null;
  }

  // Safe simulate: show a temporary highlight / toast + (optional) callback
  function simulateAction(){
    if (!currentContext){ showToast('Simulated action'); return; }
    // show message depending on action type
    const { action, label, target, el } = currentContext;
    if (action === 'open-modal') {
      showToast(`Simulating opening modal: ${label || target || 'modal'}`);
      flashElement(el);
    } else if (action === 'navigate'){
      showToast(`Simulating navigation to ${target || 'link'}`);
    } else if (action === 'download'){
      showToast(`Simulating download: ${target || 'file'}`);
    } else if (action === 'phone'){
      showToast(`Simulating call to: ${target || 'phone number'}`);
    } else {
      showToast(`Simulated: ${label || action || 'action'}`);
      if (el) flashElement(el);
    }
  }

  // Perform the real action. CAVEAT: this will actually open modals or navigate/download.
  function openReal(){
    if (!currentContext) { showToast('No action to perform'); return; }
    const { action, target, el } = currentContext;
    if (action === 'open-modal' && target && window.openModal) {
      closeTourModal();
      window.openModal(target);
      return;
    }
    if ((action === 'navigate' || (el && el.tagName && el.tagName.toLowerCase()==='a'))){
      closeTourModal();
      // if it's an anchor, navigate
      if (el && el.tagName && el.tagName.toLowerCase()==='a'){
        const href = el.getAttribute('href');
        if (href) { window.location.href = href; return; }
      }
      if (target) { window.location.href = target; return; }
    }
    if (action === 'download' && target){
      closeTourModal();
      // create hidden link to download
      const a = document.createElement('a'); a.href = target; a.download = ''; document.body.appendChild(a); a.click(); a.remove();
      return;
    }
    // fallback: just indicate it
    showToast('Performed: '+(currentContext.label || currentContext.action || 'action'));
    closeTourModal();
  }

  // small helpers
  function showToast(msg){
    const t = document.createElement('div');
    t.style.cssText = 'position:fixed; bottom:100px; right:18px; z-index:16000; background:#fff; padding:8px 12px; border-radius:10px; box-shadow:0 8px 28px rgba(0,0,0,.12); font-weight:700;';
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(()=> t.remove(), 2600);
  }

  function flashElement(el){
    if (!el) return;
    const r = el.getBoundingClientRect();
    const highlight = document.createElement('div');
    highlight.style.cssText = `position:absolute; z-index:16000; border-radius:8px; border:3px dashed rgba(212,175,55,0.95); top:${r.top+window.scrollY-8}px; left:${r.left+window.scrollX-8}px; width:${r.width+16}px; height:${r.height+16}px; pointer-events:none;`;
    document.body.appendChild(highlight);
    setTimeout(()=> highlight.remove(), 2000);
  }

  // wire modal buttons
  btnSim.addEventListener('click', simulateAction);
  btnOpen.addEventListener('click', openReal);
  btnClose.addEventListener('click', closeTourModal);
  closeTriggers.forEach(t=> t.addEventListener('click', closeTourModal));

  // Expose API globally
  window.openTourModal = openTourModal;
  window.closeTourModal = closeTourModal;

  /*
   * Auto-wire: any "explain" link created by the tour or the earlier helper can call:
   *   window.openTourModal({ title, meta, html, fg, bg, badge, context })
   * But to make it automatic when user clicks "What this does" generated by the tour,
   * we also scan for elements that have data-tour-btn and create explain clicks:
   *
   * Expected attributes (optional):
   * - data-tour-btn: short key
   * - data-action: open-modal | navigate | download | phone | submit | unknown
   * - data-target: modalId or url or file
   * - data-tour-label: friendly label
   */
  function wireExplainLinks(){
    document.querySelectorAll('[data-tour-btn]').forEach(el=>{
      // find a child explain trigger (if your markup used a .explain span), else attach to the element itself on ctrl-click
      let explain = el.querySelector('.explain') || el.querySelector('[data-explain]');

      // if no explain child, create a small explain marker (only if we haven't already added one)
      if (!explain && !el.__tourHasExplain) {
        const small = document.createElement('span');
        small.className = 'tour-explain-marker';
        small.style.cssText = 'margin-left:8px; font-weight:700; color:#1366d6; cursor:pointer; text-decoration:underline; font-size:13px;';
        small.textContent = 'What this does';
        el.appendChild(small);
        explain = small;
        el.__tourHasExplain = true;
      }

      if (!explain) return;

      if (explain.__tourWired) return; // idempotent
      explain.__tourWired = true;

      explain.addEventListener('click', (e)=>{
        const action = el.dataset.action || 'unknown';
        const target = el.dataset.target || '';
        const label = el.dataset.tourLabel || (el.innerText||el.value||'Action').trim();
        // compute colors
        const cs = window.getComputedStyle(el);
        const fg = cs.color;
        const bg = cs.backgroundColor;
        const meta = `Element: ${el.tagName.toLowerCase()}${ el.id ? ' #' + el.id : '' } ${ el.className ? ' .' + el.className.split(' ').join('.') : '' }`;
        const html = `<div style="max-height:40vh; overflow:auto;"><strong>Action:</strong> ${action}<br><strong>Target:</strong> ${target || '—'}<hr style="margin:8px 0;">Preview: This will ${ action==='open-modal' ? 'open the modal' : action==='navigate' ? 'navigate to the page' : action==='download' ? 'download a file' : 'perform the action' }.</div>`;
        openTourModal({
          title: label,
          meta: meta,
          html: html,
          fg: fg,
          bg: bg,
          badge: action.toUpperCase(),
          context: { action, target, label, el }
        });
        e.stopPropagation();
      });
    });
  }

  // Run initial wire (and also expose function to re-run)
  wireExplainLinks();
  window.wireTourExplainLinks = wireExplainLinks;

})();

</script>


</body>
</html>
